<!DOCTYPE html>
<html>
<head>
<title>CANVAS TEST</title>
<!--[if lt IE 9]>                               // Explorer Canvasを読み込む
<script src="js/excanvas.js"></script>
<![endif]-->

</head>
<body>
    ラングトンの蟻
    <div>
        <button id="prev">prev</button>
        <button id="next">next</button>
        </div>
        <canvas id="cv1" width="1080" height="680"></canvas>        
    <script type="text/javascript">        
        let curPhase = 1
        const addPhase = 200

        // 戻るボタン押した際の処理
        function prev() {
            curPhase--
            if(curPhase <= 0)
            {
                curPhase += addPhase
            }
            else {
                draw()
            }
        };
        
        // 次へボタン押した際の処理
        function next() {
            curPhase += addPhase
            draw()
        };
        
        const prevBtn = document.getElementById('prev');
        prevBtn.addEventListener('click', prev);
        const nextBtn = document.getElementById('next');
        nextBtn.addEventListener('click', next);
        
        draw()

        // 描画処理
        function draw() {
            const blackPanels = []
            const antPos = {x:0, y: 0}
            
            const centerX = 1080 / 2
            const centerY = 680 / 2
            const n = 10
            var cv = document.getElementById('cv1');
            if (!cv) { return; }
        
            var ct = cv.getContext('2d');
            if (!ct) { return; }
        
            ct.clearRect(0, 0, 10000, 10000)
            ct.fillStyle = '#ffcccc';
            ct.fillRect(0, 0, cv.width, cv.height);
        
            antPos.x = 0
            antPos.y = 0
            directionX = 0
            directionY = 1
            for(let i = 0;i < curPhase;i++)
            {
                antPos.x += directionX
                antPos.y += directionY
                const panelIndex = blackPanels.findIndex(panel => panel.x === antPos.x && panel.y === antPos.y)
                if(panelIndex !== -1)
                {
                    blackPanels.splice(panelIndex, 1);
                    if(directionX === 0 && directionY == 1){
                        directionX = -1
                        directionY = 0
                    }
                    else if(directionX === 1 && directionY == 0){
                        directionX = 0
                        directionY = 1
                    }
                    else if(directionX === 0 && directionY == -1){
                        directionX = 1
                        directionY = 0
                    }
                    else if(directionX === -1 && directionY == 0){
                        directionX = 0
                        directionY = -1
                    }
                }
                else {
                    blackPanels.push({x:antPos.x, y: antPos.y})
                    if(directionX === 0 && directionY == 1){
                        directionX = 1
                        directionY = 0
                    }
                    else if(directionX === 1 && directionY == 0){
                        directionX = 0
                        directionY = -1
                    }
                    else if(directionX === 0 && directionY == -1){
                        directionX = -1
                        directionY = 0
                    }
                    else if(directionX === -1 && directionY == 0){
                        directionX = 0
                        directionY = 1
                    }
                }
            }
        
            blackPanels.forEach(panel => {
                ct.fillStyle = '#000000';
                ct.fillRect(panel.x*n + centerX, -panel.y*n + centerY, n, n);
            })
            ct.beginPath();
            ct.strokeStyle = '#ff0000';
            ct.arc(antPos.x*n + n/2 + centerX, -antPos.y*n + n/2 + centerY, n/2, 0, Math.PI * 2, false);  // 円を描画する
            ct.stroke();
        }
        </script>
</body>
</html>